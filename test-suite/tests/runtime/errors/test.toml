name = "Runtime Error Handling"
description = "Test error conditions across all Myco interfaces - each test should fail with specific uncaught errors"

[[tests]]
name = "read non-existent file"
script = "read_nonexistent_file.ts"
expected_stdout = "Testing read non-existent file\n"
expected_stderr_pattern = """\
Error running script: Error: Failed to read file '\\./tests/runtime/errors/fixtures/tmp/nonexistent_file\\.txt': No such file or directory \\(os error 2\\)
\\s+at Object\\.read \\(<anonymous>:\\d+:\\d+\\)
\\s+at default \\(file:///.+/read_nonexistent_file\\.ts:\\d+:\\d+\\)
\\s+at async myco:main:\\d+:\\d+
"""
expected_exit_code = 1
timeout_ms = 5000

[[tests]]
name = "write to read-only path"
script = "write_readonly_path.ts"
expected_stdout = "Testing write to read-only path\n"
expected_stderr_pattern = """\
Error running script: Error: Parent path is not a directory: /dev/null
\\s+at Object\\.requestWrite \\(<anonymous>:\\d+:\\d+\\)
\\s+at default \\(file:///.+/write_readonly_path\\.ts:\\d+:\\d+\\)
\\s+at async myco:main:\\d+:\\d+
"""
expected_exit_code = 1
timeout_ms = 5000

[[tests]]
name = "invalid read operation"
script = "invalid_read_operation.ts"
expected_stdout = "Testing invalid read operation\n"
expected_stderr_pattern = """\
Error running script: Error: Path is not a file: \\./tests/runtime/errors/fixtures
\\s+at Object\\.requestRead \\(<anonymous>:\\d+:\\d+\\)
\\s+at default \\(file:///.+/invalid_read_operation\\.ts:\\d+:\\d+\\)
\\s+at myco:main:\\d+:\\d+
"""
expected_exit_code = 1
timeout_ms = 5000

[[tests]]
name = "invalid directory operation"
script = "invalid_directory_operation.ts"
expected_stdout = "Testing invalid directory operation\n"
expected_stderr_pattern = """\
Error running script: Error: .+
\\s+at .+
\\s+at default \\(file:///.+/invalid_directory_operation\\.ts:\\d+:\\d+\\)
\\s+at .+
"""
expected_exit_code = 1
timeout_ms = 5000

[[tests]]
name = "stat non-existent file"
script = "stat_nonexistent_file.ts"
expected_stdout = "Testing file stats on non-existent file\n"
expected_stderr_pattern = """\
Error running script: Error: Failed to get file metadata for '\\./tests/runtime/errors/fixtures/tmp/definitely_nonexistent\\.txt': No such file or directory \\(os error 2\\)
\\s+at Object\\.stat \\(<anonymous>:\\d+:\\d+\\)
\\s+at default \\(file:///.+/stat_nonexistent_file\\.ts:\\d+:\\d+\\)
\\s+at async myco:main:\\d+:\\d+
"""
expected_exit_code = 1
timeout_ms = 5000

[[tests]]
name = "invalid URL fetch"
script = "invalid_url_fetch.ts"
expected_stdout = "Testing invalid URL fetch\n"
expected_stderr_pattern = """\
Error running script: Error: .+
\\s+at .+
\\s+at default \\(file:///.+/invalid_url_fetch\\.ts:\\d+:\\d+\\)
\\s+at .+
"""
expected_exit_code = 1
timeout_ms = 5000

[[tests]]
name = "path traversal attack"
script = "path_traversal_attack.ts"
expected_stdout = "Testing path traversal attack\n"
expected_stderr_pattern = """\
Error running script: Error: .+
\\s+at .+
\\s+at default \\(file:///.+/path_traversal_attack\\.ts:\\d+:\\d+\\)
\\s+at .+
"""
expected_exit_code = 1
timeout_ms = 5000

[[tests]]
name = "URL injection attack"
script = "url_injection_attack.ts"
expected_stdout = "Testing URL injection attack\n"
expected_stderr_pattern = """\
Error running script: Error: .+
\\s+at .+
\\s+at default \\(file:///.+/url_injection_attack\\.ts:\\d+:\\d+\\)
\\s+at .+
"""
expected_exit_code = 1
timeout_ms = 5000

[[tests]]
name = "protocol injection attack"
script = "protocol_injection_attack.ts"
expected_stdout = "Testing protocol injection attack\n"
expected_stderr_pattern = """\
Error running script: Error: .+
\\s+at .+
\\s+at default \\(file:///.+/protocol_injection_attack\\.ts:\\d+:\\d+\\)
\\s+at .+
"""
expected_exit_code = 1
timeout_ms = 5000

[[tests]]
name = "network error non-existent domain"
script = "network_error_nonexistent_domain.ts"
expected_stdout = "Testing network error (non-existent domain)\n"
expected_stderr_pattern = """\
Error running script: Error: .+
\\s+at .+
\\s+at default \\(file:///.+/network_error_nonexistent_domain\\.ts:\\d+:\\d+\\)
\\s+at .+
"""
expected_exit_code = 1
timeout_ms = 10000

[[tests]]
name = "Promise.reject error"
script = "promise_reject_error.ts"
expected_stdout = "Testing Promise.reject\n"
expected_stderr_pattern = """\
Error running script: Error: Immediate rejection
\\s+at default \\(file:///.+/promise_reject_error\\.ts:\\d+:\\d+\\)
\\s+at myco:main:\\d+:\\d+
"""
expected_exit_code = 1
timeout_ms = 5000

[[tests]]
name = "async function throwing"
script = "async_function_throwing.ts"
expected_stdout = "Testing async function throwing\n"
expected_stderr_pattern = """\
Error running script: Error: Async function threw error
\\s+at .+
\\s+at .+
\\s+at .+
"""
expected_exit_code = 1
timeout_ms = 5000

[[tests]]
name = "Promise.all with rejection"
script = "promise_all_rejection.ts"
expected_stdout = "Testing Promise.all with rejection\n"
expected_stderr_pattern = """\
Error running script: Error: Promise\\.all error
\\s+at .+
\\s+at .+
\\s+at .+
"""
expected_exit_code = 1
timeout_ms = 5000

[[tests]]
name = "Promise.race with rejection"
script = "promise_race_rejection.ts"
expected_stdout = "Testing Promise.race with rejection\n"
expected_stderr_pattern = """\
Error running script: Error: Fast rejection
\\s+at .+
\\s+at .+
\\s+at .+
"""
expected_exit_code = 1
timeout_ms = 5000

[[tests]]
name = "TypeError uncaught"
script = "type_error_uncaught.ts"
expected_stdout = "Testing TypeError uncaught\n"
expected_stderr_pattern = """\
Error running script: TypeError: Type error uncaught
\\s+at default \\(file:///.+/type_error_uncaught\\.ts:\\d+:\\d+\\)
\\s+at .+
"""
expected_exit_code = 1
timeout_ms = 5000

[[tests]]
name = "ReferenceError uncaught"
script = "reference_error_uncaught.ts"
expected_stdout = "Testing ReferenceError uncaught\n"
expected_stderr_pattern = """\
Error running script: ReferenceError: Reference error uncaught
\\s+at default \\(file:///.+/reference_error_uncaught\\.ts:\\d+:\\d+\\)
\\s+at .+
"""
expected_exit_code = 1
timeout_ms = 5000

[[tests]]
name = "unhandled exception"
script = "unhandled_exception.ts"
expected_stdout = "Testing unhandled exception\n"
expected_stderr_pattern = """\
Error running script: Error: This is an unhandled exception
\\s+at default \\(file:///.+/unhandled_exception\\.ts:\\d+:\\d+\\)
\\s+at .+
"""
expected_exit_code = 1
timeout_ms = 5000 